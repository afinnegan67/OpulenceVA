<div class="container">
  <div class="header">
    <h1>ðŸš¨ Active Problems</h1>
    <p>Track and resolve issues across all projects</p>
  </div>

  <!-- Summary Bar -->
  <div style="display:flex; gap:1rem; flex-wrap:wrap; justify-content:center; margin-bottom:1rem;">
    <div style="flex:1; min-width:150px; background:white; padding:1rem; border-radius:12px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.05);">
      <h2 style="color:#4f46e5;">12</h2>
      <p>Open Issues</p>
    </div>
    <div style="flex:1; min-width:150px; background:white; padding:1rem; border-radius:12px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.05);">
      <h2 style="color:#e11d48;">4</h2>
      <p>Critical</p>
    </div>
    <div style="flex:1; min-width:150px; background:white; padding:1rem; border-radius:12px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.05);">
      <h2 style="color:#059669;">5</h2>
      <p>Resolved This Week</p>
    </div>
  </div>

  <!-- Filters -->
  <div style="margin-bottom:1rem; text-align:center;">
    <select id="statusFilter" style="padding:0.5rem; border-radius:8px; border:1px solid #ddd;">
      <option value="">All Statuses</option>
      <option value="Critical">Critical</option>
      <option value="High">High</option>
      <option value="Medium">Medium</option>
      <option value="Low">Low</option>
    </select>
    <select id="projectFilter" style="padding:0.5rem; border-radius:8px; border:1px solid #ddd; margin-left:0.5rem;">
      <option value="">All Projects</option>
      <option value="Project 1">Project 1</option>
      <option value="Project 2">Project 2</option>
      <option value="Project 3">Project 3</option>
    </select>
  </div>

  <!-- Problem Table -->
  <div class="dashboard-space" style="overflow-x:auto;">
    <table id="problemsTable" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#eef2ff; color:#4f46e5;">
          <th style="padding:0.75rem; text-align:left;">Status</th>
          <th style="padding:0.75rem; text-align:left;">Issue</th>
          <th style="padding:0.75rem; text-align:left;">Project</th>
          <th style="padding:0.75rem; text-align:left;">Crew</th>
          <th style="padding:0.75rem; text-align:left;">Reported</th>
          <th style="padding:0.75rem; text-align:left;">Due</th>
          <th style="padding:0.75rem;">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span style="color:white; background:#e11d48; padding:0.25rem 0.5rem; border-radius:6px;">Critical</span></td>
          <td>Safety harness failure</td>
          <td>Project 1</td>
          <td>Crew A</td>
          <td>2025-08-01</td>
          <td>2025-08-03</td>
          <td><button onclick="openProblemModal('Safety harness failure','Critical','Crew A','Immediate fix required for all harnesses')"
            style="background:#4f46e5; color:white; border:none; padding:0.4rem 0.8rem; border-radius:6px; cursor:pointer;">View</button></td>
        </tr>
        <tr>
          <td><span style="color:white; background:#f59e0b; padding:0.25rem 0.5rem; border-radius:6px;">High</span></td>
          <td>Material shortage: Concrete</td>
          <td>Project 2</td>
          <td>Crew B</td>
          <td>2025-08-02</td>
          <td>2025-08-05</td>
          <td><button onclick="openProblemModal('Material shortage: Concrete','High','Crew B','Order placed, awaiting delivery')"
            style="background:#4f46e5; color:white; border:none; padding:0.4rem 0.8rem; border-radius:6px; cursor:pointer;">View</button></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div id="problemModal" style="
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%, -50%);
  background:white;
  padding:20px;
  border-radius:16px;
  box-shadow:0 8px 32px rgba(0,0,0,0.3);
  z-index:1000;
  width:350px;
  max-width:90%;
">
  <h3 id="problemTitle" style="color:#4f46e5; margin-bottom:10px;"></h3>
  <p><strong>Status:</strong> <span id="problemStatus"></span></p>
  <p><strong>Crew:</strong> <span id="problemCrew"></span></p>
  <p><strong>Details:</strong> <span id="problemDetails"></span></p>
  <button onclick="closeProblemModal()" style="
    margin-top:15px;
    padding:8px 14px;
    border:none;
    border-radius:8px;
    background:#4f46e5;
    color:white;
    cursor:pointer;
  ">Close</button>
</div>

<!-- Overlay -->
<div id="problemOverlay" style="
  display:none;
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.5);
  z-index:999;
" onclick="closeProblemModal()"></div>

<script>
function openProblemModal(title,status,crew,details) {
  document.getElementById('problemTitle').innerText = title;
  document.getElementById('problemStatus').innerText = status;
  document.getElementById('problemCrew').innerText = crew;
  document.getElementById('problemDetails').innerText = details;
  document.getElementById('problemModal').style.display = 'block';
  document.getElementById('problemOverlay').style.display = 'block';
}
function closeProblemModal() {
  document.getElementById('problemModal').style.display = 'none';
  document.getElementById('problemOverlay').style.display = 'none';
}

// Filter logic
document.getElementById('statusFilter').addEventListener('change', filterProblems);
document.getElementById('projectFilter').addEventListener('change', filterProblems);

function filterProblems() {
  const status = document.getElementById('statusFilter').value;
  const project = document.getElementById('projectFilter').value;
  const rows = document.querySelectorAll('#problemsTable tbody tr');
  rows.forEach(row => {
    const rowStatus = row.cells[0].innerText.trim();
    const rowProject = row.cells[2].innerText.trim();
    if ((status === '' || rowStatus === status) && (project === '' || rowProject === project)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}
</script>
